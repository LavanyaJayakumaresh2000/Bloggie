@model List<Bloggie.Web.Models.Domain.BlogPost>
@{
    var previous = ViewBag.PageNumber - 1;
    var next = ViewBag.PageNumber + 1;
}

<div class="bg-secondary bg-opacity-10 py-2">
    <div class="container">
        <h1>List All BlogPosts - Admin functionality</h1>
    </div>
</div>

<div class="container py-5">
    <form method="get" id="searchForm">
        <div class="row justify-content-between mb-3">
            <div class="d-flex col-md-3">
                <input class="form-control me-3" id="searchInput" name="searchQuery" value="@ViewBag.SearchQuery"/>
                <button class="btn btn-warning" type="submit">Search</button>
            </div>
        </div>
    </form>
    @if(Model != null && Model.Any())
    {
        <table class="table">
            <thead>
                <tr>
                    <td>Id</td>
                    <td> Heading
                        <span>
                            <span>
                                <a class="btn btn-light"
                                asp-controller="AdminBlogPosts"
                                asp-action="List"
                                asp-route-searchQuery="@ViewBag.SearchQuery"
                                asp-route-sortBy=Asc
                                asp-route-sortingField=Heading>

                                    <i class="bi bi-arrow-up"></i>
                                </a>
                            </span>
                            <span>
                                <a class="btn btn-light"
                                asp-controller="AdminBlogPosts"
                                asp-action="List"
                                asp-route-searchQuery="@ViewBag.SearchQuery"
                                asp-route-sortBy=Desc
                                asp-route-sortingField=Heading>

                                    <i class="bi bi-arrow-down"></i>
                                </a>
                            </span>
                        </span>
                    </td>
                    <td>Tags</td>
                    <td> </td>
                    <td> </td>
                </tr>
            </thead>
            <tbody>

                @foreach (var blog in Model)
                {
                    <tr>
                        <td>@blog.Id</td>
                        <td>@blog.Heading</td>
                        <td>
                            <div class="d-flex">
                                @foreach (var tag in blog.Tags)
                                {
                                    <span class="badge bg-secondary me-1">@tag.Name</span>
                                }
                            </div>
                        </td>
                        <td>
                            <a asp-area="" asp-controller="AdminBlogPosts" asp-action="Edit" asp-route-id="@blog.Id">Edit</a>
                        </td>
                        <td>
                            <a asp-area="" asp-controller="AdminBlogPosts" asp-action="Delete" asp-route-id="@blog.Id">Delete</a>
                        </td>
                    </tr>
                }

            </tbody>
        </table>

        <div class="container mb-3">
            <nav aria-label="Page navigation example">
                <ul class="pagination">
                    <li class="page-item"><a class="page-link" asp-controller="AdminBlogPosts"
                        asp-action="List" asp-route-pageNumber="@previous" asp-route-pageSize="@ViewBag.PageSize">Previous</a></li>
                    @for(int i=1; i<= ViewBag.TotalCount; i++)
                    {
                        <li class="page-item"><a class="page-link" asp-controller="AdminBlogPosts"
                        asp-action="List" asp-route-pageNumber="@i" asp-route-PageSize="@ViewBag.PageSize">@i</a></li>
                    }
                    
                    <li class="page-item"><a class="page-link" asp-controller="AdminBlogPosts"
                        asp-action="List" asp-route-pageNumber="@next" asp-route-pageSize="@ViewBag.PageSize">Next</a></li>
                </ul>
            </nav>
        </div>
    }
    else
    {
        <p>No Blog Post Found!</p>
    }
</div>


@section Scripts{
    <script>
        const search = document.getElementById('searchInput');
        const form =document.getElementById('searchForm');


        async function SearchThevalue(){
            if(this.value.trim() === ''){
                form.submit();
            }
        }

        search.addEventListener('input',SearchThevalue);

    </script>
}